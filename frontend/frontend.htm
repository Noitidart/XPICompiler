<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>XPICompiler</title>
	</head>
	<style>
		body {
			display: flex;
			margin: 0px;
			position: fixed;
			width: 100%;
			height: 100%;
			font-family: Verdana;
			font-size: 14px;
		}
		.main-pane {
			border-right: 1px solid rgb(198, 201, 206);
			background: linear-gradient(to right, #EFEFEF 99%,rgba(204,204,204,.5) 100%);
			flex: 1;
			height: 100%;
			display: flex;
			flex-direction: column;
			padding:5px;
			/*box-shadow: -2px 0px 5px 0px rgb(204, 204, 204) inset;*/
			overflow: hidden;
		}
		.main-pane:nth-of-type(2) {
			background: none repeat scroll 0% 0% transparent;
			box-shadow: 2px 0px 5px 0px rgba(198, 201, 206, 0.3);
		}
		.main-pane:nth-of-type(3) {
			background: none repeat scroll 0% 0% transparent;
			box-shadow: none;
		}
		#logo {
			/*
			font-size: 1.7em;
			*/
			font-weight: bold;
			text-shadow: 1px 1px 0px #CCC;
			color: #666;
		}
		#folders {
			/*border: 1px solid #666;*/
		}
		
		/*start recent folder stuff*/
		.folder {
			background: transparent url('folder16.png') no-repeat 3px center; 
			padding: 5px 5px 5px 24px;
			border-radius: 5px;
			margin: 5px 0;
			cursor: pointer;
			 flex-shrink: 0;
		}
		.folder span[xfield=name] {
			display:block !important;
			font-weight: bold;
		}
		.folder span[xfield] {
			display:none;
		}
		/*on hover of folder*/
		.folder:hover {
			background: #DFDFDF url('folder32.png') no-repeat 5px center; 
			padding-left: 44px;
		}
		.folder:hover span[xfield] {
			display: block;
		}
		/*end recent folder stuff*/
		
		/*start recent xpi stuff*/
		.xpi {
			background: transparent url('xpi16.png') no-repeat 3px center; 
			padding: 5px 5px 5px 24px;
			border-radius: 5px;
			margin: 5px 0;
			cursor: pointer;
			/*flex-shrink: 0;*/ /*i dont know if needed, but during diff of files i found it was in .folder so i added it here too but kept it commented out*/
		}
		.xpi span[xfield=name] {
			display:block !important;
			font-weight: bold;
		}
		.xpi span[xfield] {
			display:none;
		}
		/*on hover of xpi*/
		.xpi:hover {
			background: #EFEFEF url('xpi32.png') no-repeat 5px center; 
			padding-left: 44px;
		}
		.xpi:hover span[xfield] {
			display: block;
		}
		/*end recent xpi stuff*/
		
		
		/*options form*/
		#options {
			display: flex;
			flex-direction: column;
		}
		#options span {
			display: flex;
			flex-direction: row;
			margin: 2px 0;
			white-space: nowrap;
		}
		#options span *:first-child {
			flex: 1;
		}
		#options span select {
			width: 11em;
		}
		/*end options form*/
		
		/*browse div*/
		#browse {
			display: flex;
			flex-direction: row;
		}
		
		#browse input {
			flex: 1;
			text-align: left;
		}
		
		#browse .button {
			background-color: #CAE00D;
			padding:0;
			border-radius: 5px;
			color: #000;
			font-weight: bold;
			cursor: pointer;
			margin-left: 5px;
			font-size: 1.1em;
		}
		
		#browse .compile {
			background: transparent url('compile.png') no-repeat center center;
			width: 32px;
			height: 32px;
		}
		
		#browse .browse {
			background: transparent url('folder_search.png') no-repeat center 3px;
			width: 32px;
			height: 32px;
		}
		/*autocomplete*/
		#browseac {
			border: 1px solid rgb(153, 153, 153);
			background: #fff;
			overflow: auto;
			position: absolute;
		}
		
		#browseac a {
			padding: 2px 5px;
			white-space: nowrap;
			overflow: hidden;
			text-decoration: none;
			display: block;
		}
		
		#browseac a:focus {
			background-color: steelblue;
			border: none;
		}
		
		#browseac a:hover {
			background-color: #F0F0F0;
		}
		
		/*end browse div*/
		
		/*status*/
		#statusWrap {
			background-color: skyblue;
			height: 90%;
			position: relative;
			overflow: auto;
			display: flex;
			justify-content: flex-end;
			flex-direction: column;
		}
		#status {
			background-color: steelblue;
			position: relative;
			overflow: visible;
			flex-shrink: 1;
		}
		#status > span {
			transition: height .4s ease-out, opacity .4s ease-out;
			position: relative;
			display: block;
			flex-shrink: 0;
			background-color: springgreen;
			overflow:hidden;
		}
		/*end status*/
	</style>
	<script src="date.extensions.js"></script>
	<script>
		var csses = {}; //holds css style sheets ids here dynamically added, used so we dont multi add or reuse same id, id needed cuz need to give each msg its unique id as it likely has may have unique height
		function addMsg(msg, updateable) {
			//adds new line to status pane
			//if want to make it updateable put in a <!---->BLAH<!----> OR `~`BLAH`~`
			var status = document.querySelector('#status');
			var el = document.createElement('span');
			if (updateable) {
				msg = msg.replace('`~`','<!---->');
				msg = msg.replace('`~`','<!---->');
			}
			el.innerHTML = msg;			
			el.setAttribute('style','transition:none');
			status.appendChild(el);
			
			var itsH = el.offsetHeight;
			
			var css = document.createElement('style');
			var newid = new Date().getTime();
			while (csses[newid]) {
				console.log('csses id exists: existing id is = ' + newid);
				newid--;
			}
			csses[newid] = 1;
			css.innerHTML = '.a' + newid + ' {height:' + itsH + 'px;opacity:1;}';
			css.setAttribute('id', 'c' + newid);
			el.setAttribute('class', 'a' + newid);
			document.body.appendChild(css);
			
			el.setAttribute('style','transition:none;height:0;opacity:0');
			
			var trEnd = function(e) { 
			//alert(e.propertyName)
				if (e.propertyName == 'opacity') { //because height finishes in .2s and opacity in .4, we need the style attr in tact till the opacity transiton is complete
					//alert('now removing');
					el.removeAttribute('class');
					document.body.removeChild(css);
					delete csses[newid];
				} else {
					//alert('not yet');
				}
			}
			el.addEventListener('transitionend', trEnd, false);
			
			setTimeout(function(){el.removeAttribute('style');},10);
			
			return;
			
			var statusWrap = document.querySelector('#statusWrap');
			var h1 = document.querySelector('h1');
			setTimeout(function(){h1.innerHTML = statusWrap.offsetHeight + ' | ' + status.offsetHeight ;},500);
		}
		function updateMsg(msg) {
			//var status = document.querySelector('#status');
			var lastMsg = document.querySelector('#status > span:last-of-type');
			if (lastMsg.innerHTML.indexOf('<\!---->') > -1) {
				lastMsg.innerHTML = lastMsg.innerHTML.replace(/<\!---->[\s\S]*?<\!---->/,'<\!---->' + msg + '<\!---->');
			}
		}
		
		function bac_blur(e) {
			
			//var bb = bi.nextSibling.nextSibling; //browse button
			//bb.innerHTML = 'Browse';
			//browseac.style.display = 'none';
		}
		
		function bac_focus(e) {
			setTimeout(function() {
				if (bi.selectionStart == 0 && bi.selectionEnd == bi.value.length) {
					bi.selectionStart = bi.selectionEnd;
				}
				//bi.setSelectionRange(bi.value.length, bi.value.length);
			}, 10);
			console.log('done');
			//var bb = bi.nextSibling.nextSibling; //browse button
			//autocomplete();
			//bb.innerHTML = 'Press Enter';
		}
		
		var bi;
		var browseac;
		var bpane;
		
		function init() {		
			//browse ac positioning
			browseac = document.querySelector('#browseac');
			bi = document.querySelector('#browse input');
			bpane = document.querySelector('#browse');
			var rect = bi.getBoundingClientRect();
			browseac.style.left = rect.left + 'px';
			browseac.style.top = (rect.top + rect.height) + 'px'
			browseac.style.minWidth = rect.width + 'px';
			
			bi.addEventListener('focus', bac_focus, false);
			bi.addEventListener('blur', bac_blur, false);
			//bi.addEventListener('keyup', autocomplete, false); //need to add this from jsm
			
			window.addEventListener('mousedown', dclick, false);
		}
		
		function dclick(e) {
			if (e.target.parentNode.id == 'browseac') {
				return;
				browseac.style.display = 'none';
			}
			if (e.target.parentNode.id == 'browse' && e.target.nodeName == 'INPUT') {
				return;
				browseac.style.display = 'none';
			}
			browseac.style.display = 'none';
		}
		
		window.addEventListener('DOMContentLoaded',init,false);
	</script>
<body>
	<div class="main-pane">
		<h1 id="logo" style="flex-shrink:0;">
			XPICOMPILER
		</h1>
		<h2 style="flex-shrink:0;">OPTIONS</h2>
		<form id="options" style="flex-shrink:0;">
			<span>
				<span>Install</span>
				<select name="install">
					<option value="0">None</option>
					<option value="1">Normal</option>
					<option value="2" selected>Silent</option>
				</select>
			</span>
			<span>
				<span>XPI Filename</span>
				<select name="filename">
					<option value="0">Custom</option>
					<option value="1" selected>Directory Name</option>
				</select>
			</span>
			<span>
				<span>XPI Compression</span>
				<select name="location">
					<option value="0" selected>None</option>
					<option value="1">Fast</option>
					<option value="2">Normal</option>
					<option value="3">Best</option>
				</select>
			</span>
			<span>
				<span>XPI Location</span>
				<select name="location">
					<option value="0">Browse</option>
					<option value="1" selected>Compiled Directory</option>
				</select>
			</span>
			<span>
				<span devnote="(show if install value is not 0)">Delete XPI After Install</span>
				<select name="overwrite">
					<option value="0">No</option>
					<option value="1" selected>Yes</option>
				</select>
			</span>
			<span>
				<span>Overwrite</span>
				<select name="overwrite">
					<option value="0">No</option>
					<option value="1" selected>Yes</option>
				</select>
			</span>
			<span>
				<span devnote="(if not overwrite)">Filename Append</span>
				<select name="filename_append">
					<option value="0">Date and Time</option>
					<option value="1">Number</option>
				</select>
			</span>
		</form>
		<h2 style="flex-shrink:0;">BROWSE</h2>
		<div id="browse" style="flex-shrink:0;">
			<div id="browseac" style="display:none;"></div><!--placement is important here, it should be after the text field so shift+tab takes it back into the input field-->
			<input type="text">
			<span class="button browse"></span>
			<span class="button compile"></span>
		</div>
		<h3 style="flex-shrink:0;">Recent Folders</h3>
		<div id="folders" style="overflow:auto; margin-bottom: 1%;">
			<div class="folder">
				<span xfield="name">XPICompiler</span>
				<span xfield="path">../../.../XPICompiler</span>
			</div>
		</div>
	</div>
	<div class="main-pane">
		<h2 style="flex-shrink:0;">HISTORY</h2>
		<div id="xpis" style="overflow:auto; margin-bottom: 1%;">
			<div class="xpi">
				<span xfield="name">XPICompiler</span>
				<span xfield="date">3 days ago</span>
				<span xfield="compress">34.5kb - No Compression</span>
				<span xfield="folder">../../.../XPICompiler</span>
				<!--<span xfield="path" devnote="only show this if different from folder">../../.../XPICompiler</span>-->
			</div>
		</div>
	</div>
	<div class="main-pane">
		<h2 onclick="addMsg(new Date().toLocaleString())">STATUS</h2>
		<div id="statusWrap">
			<div id="status"></div>
		</div>
	</div>
</body>
</html>
